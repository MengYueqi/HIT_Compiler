# HIT_Compiler
哈工大2024春编译原理

## 实验1: 词法分析与语法分析
实验 1 为使用 GNU Flex 和 GNU Bison 完成词法分析和语法分析。其中文法定义参考[文法定义](./syntax_definition.md)。这是一个非常非常老的编译器编写方式，而且不是很好上手。以下对代码进行简单介绍，希望能帮学弟学妹们快速上手。

首先，代码的架构如下：

### Flex 文件
我们首先需要编写词法分析器，具体的语法大家 GPT 一下就明白。词法分析器在 `lex.l` 中进行编写。编写完成后，在 MacOS 或 Linux 下使用命令：
```
flex lex.l
```
完成编译，编译生成 `lex.yy.c` 文件。此文件为词法分析器对应的 C 语言文件。使用 GCC 对文件进行编译，之后执行文件，如下：
```
gcc lex.yy.c -o test
./test
```
即可完成词法分析。但要注意，不能直接使用本项目中的 `lex.l` 文件进行以上操作实现词法分析。因为为了完成实验要求，本项目中的 `lex.l` 还引用了了其他文件且没有 `main` 函数。

### Bison 文件
语法分析器主要是在 `syntax.y` 中进行的实现。这里的语法也比较固定。其中几个比较重要的是：首先，要在首部生命一个 `union`，用来在语法分析器和词法分析器中传递数据。其次，要注意终结符要用 `token` 声明这些符号，非终结符字符用 `type` 声明。终结符和非终结符都是 `Node` 类型。完成 `syntax.y` 后使用如下命令进行编译：
```
bison -d syntax.y
```
会生成 `syntax.tab.c` `syntax.tab.h` 两个文件。

### 语法树实现
在完成语法分析器和词法分析器后，我们还需要完成语法树的实现。这里实现一个树节点 `Node` 并且在语法分析和词法分析中，创建对应的节点。具体创建的部分的实现在对应产生式的花括号中。这里：`$n` 表示规则匹配到的第 n 个子节点的语义值。`$$` 表示生成式左部的语义值。而具体语法分析树的实现过程在文件 `tree.c` 中，核心思想是对语法树进行一个前序遍历。

### 编译过程说明
如需使用该项目的代码内容，可以在 MacOS 下使用命令：
```
make
```
进行编译，如果是 Linux 环境，需要注意，在最后编译生成可执行文件 `parser` 时，需要将链接库的选项由 `-ll` 改为 `-lfl`。具体编译的顺序如下：
```
bison -d syntax.y
flex lex.l
gcc -Wall lex.yy.c tree.c syntax.tab.c main.c -o parser -ll
```
你也可以逐步进行编译，并查看编译的结果。

## 说明
1. 此项目仅供学习交流，请勿将此项目的代码用作商业用途。如用作商业用途，作者不承担任何责任。
2. 如果你需要任何课程相关的其他资料，请联系我的邮箱：mengyq2002@gmail.com。
2. 感谢 Open AI [ChatGPT](https://chat.openai.com) 和 Google [Gemini](https://gemini.google.com/app/) 的大力支持。